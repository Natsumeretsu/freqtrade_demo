# 完整量化交易生态 - 全面补充指南（本仓库基座版）

更新日期：2026-01-15



> **⚠️ 历史文档说明（2026-01-17）**：
> 本文档中提及的 vbrain、vharvest、local_rag、in_memoria 等系统已于 2026-01-17 完全移除。
> 当前项目采用 Docker MCP ToolKit 的 `memory` 工具（知识图谱）+ 实时获取（fetch/playwright/context7/duckduckgo）方案。
> 本文档保留作为历史记录，文中相关内容仅供参考，不再适用于当前架构。


- 日期：2026-01-15
- 版本：1.0
- 范围：从数据采集 → 研究/训练 → 信号 → 回测/执行 → 复盘/风控 → 知识库/运维
- 目标：在 `freqtrade_demo` 的真实约束下，补齐“完整量化交易生态”的顶层框架选型，并严格遵守“能不造轮子就不造轮子”铁律。

---

## 0. 结论（先给你一张“全景地图”）

1) **你现在已经拥有一个可运行、可复现、可扩展的最小闭环**：`Freqtrade（执行/回测） + Qlib（研究/评估） + 03_integration（桥接与单一口径） + vbrain（离线知识库/检索加速）`。继续沿着这个基座演进，比引入大量“平台组件”更符合本仓库的轻量与可控目标。

2) **“顶级框架补全”不等于“立即全部引入依赖”**：本仓库强调“模块级一次性落地”，即：当你决定引入某个新基础设施（例如 TSDB/编排/监控）时，要一次性改完入口、配置、脚本、文档与验收；否则宁可先不引入，避免形成不可控技术债（见 `docs/guidelines/refactor_policy.md`）。

3) **默认推荐：保持脚本驱动 + 文件落盘**。只有当你明确进入“多策略、多币种、多时间尺度、24/7 常驻 + 可观测性要求高”的阶段，才考虑引入更重的基础设施（TSDB、编排系统、监控系统）。

---

## 1. 本仓库的“事实基座”（不要脱离现实选型）

### 1.1 分层目录（已落地）

- `01_freqtrade/`：策略执行层（策略/配置/数据/回测产物）
- `02_qlib_research/`：研究层（Qlib 数据集、模型、Notebook）
- `03_integration/`：桥接层（研究层 ↔ 策略侧的复用代码：因子、特征、门控、风险缩放、数据适配）
- `04_shared/`：共享配置（可提交、可追溯）
- `docs/`：权威知识库（设计、规范、报告、离线参考资料）
- `scripts/`：统一入口（Windows PowerShell + `uv` 约束）

### 1.2 已经在用的关键能力（无需再“补框架”）

- **执行/回测**：Freqtrade（必须通过 `scripts/ft.ps1`）
- **研究/评估**：Qlib（`scripts/qlib/*.py` 与 `scripts/qlib/pipeline.ps1`）
- **特征/因子单一来源**：`04_shared/config/factors.yaml` + `03_integration/.../factor_engines/*`
- **技术指标**：TA-Lib（`talib.abstract` 已被策略与因子引擎使用）
- **离线策略参考库 / 文档检索加速**：`local_rag`（MCP server）+ `scripts/tools/vbrain.py`
- **MCP 客户端**：官方 `mcp` Python SDK（用于统一调用 MCP 工具）

---

## 2. 完整生态分层（每层“默认方案 + 何时升级”）

### 2.1 数据采集（行情/标的池/频率）

默认（推荐，已固化）：

- 使用本仓库脚本下载与管理数据：`scripts/data/download.ps1`
- 执行/回测侧由 Freqtrade 管理数据目录与格式；研究侧通过转换脚本生成 Qlib 研究数据（见 `docs/knowledge/freqtrade_qlib_engineering_workflow.md`）

何时需要升级：

- 你需要把多个来源（交易所 + 链上 + 宏观）统一到同一条数据管线，并做强审计/强可追溯。
- 你要做实时流（分钟级甚至秒级）且希望研究与执行共享同一套实时数据源。

非自研候选（按“是否需要独立于 Freqtrade”分流）：

- **仅研究用途**：直接用 Freqtrade 的历史数据 + 转换脚本即可（最少维护面）。
- **独立数据采集层**：优先考虑 `ccxt`（CEX）+ 官方 websocket（实时）组合；但注意：这会引入新的稳定性与运维面，除非你已经被 Freqtrade 的数据获取能力卡住，否则不建议提前引入。

### 2.2 数据存储（本地优先 vs 服务器化）

默认（推荐，Git 友好）：

- 文件落盘：Freqtrade `.feather` + 研究层 `.pkl`（可重建、可复现，避免 TSDB 运维）
- 产物统一落 `artifacts/`（已有多处脚本沿用该约定）

何时需要升级：

- 你需要跨策略/跨币种的高速聚合查询（分钟级数据量暴涨）；
- 你需要长期保留 Tick/成交/订单级历史；
- 你需要多端共享同一份实时数据。

非自研候选（按“是否需要服务器”）：

- **本地无服务器**：优先考虑 DuckDB（单文件、分析型强、非常适合研究/回测数据聚合）。
- **需要服务器与实时写入**：TimescaleDB（更偏交易/监控时序写入）或 ClickHouse（更偏海量分析）。这两者都属于“平台化”组件，引入前必须明确运维与备份策略。

### 2.3 特征工程与因子（避免口径漂移的核心层）

默认（已落地，强烈建议保持）：

- **单一来源**：因子声明在 `04_shared/config/factors.yaml`，计算逻辑集中在 `03_integration/trading_system/infrastructure/factor_engines/`
- 训练与预测复用同一套特征工程（避免“研究一套、实盘一套”的口径漂移）

何时需要升级：

- 因子计算成为主要瓶颈（数据量/币种数上升导致计算时间不可接受）。

非自研候选：

- **性能升级（可选）**：Polars（仅在数据量足够大时引入）；注意评估引入成本与团队学习成本。
- **指标库扩展（慎用）**：优先用现有 TA-Lib + 你已经沉淀的因子引擎；除非明确缺指标且社区已有成熟实现，否则不引入第二套指标口径。

### 2.4 研究/训练（Qlib 为主，模型按“足够好”选）

默认（推荐，已落地）：

- Qlib 组织数据与评估（IC/分位/回测风控口径等）
- 模型侧当前以 LightGBM / sklearn 为主（工程成熟、推理稳定、上线成本低）

何时需要升级到深度学习：

- 你明确需要序列建模（Transformer/LSTM）、多模态、或跨标的共享表示学习；
- 你能承担训练/推理的资源与可复现成本（GPU、版本锁定、推理延迟）。

非自研候选：

- **深度学习框架**：优先 PyTorch（生态、灵活性与研究友好）；但在本仓库语境里，它是“可选升级”，不是默认必选依赖。

### 2.5 信号 → 执行接口（把研究结果变成“可执行动作”）

默认（推荐，已落地）：

- 研究层产出模型/门控策略/风险缩放参数 → 落盘到 `02_qlib_research/models/` 与 `04_shared/config/`
- 执行层策略只做“装配与消费”，避免把训练/评估逻辑塞进 Freqtrade 策略中

关键提醒：

- 不要把“策略逻辑”与“研究/训练管线”揉在一起；桥接代码应位于 `03_integration/`，并通过脚本/配置驱动。

### 2.6 回测/仿真/实盘执行（加密货币）

默认（推荐）：

- CEX（中心化交易所）方向性策略：Freqtrade（见 `docs/reports/crypto_trading_framework_review_2026-01-15_v1.0.md`）

何时需要引入第二执行框架：

- 你要做 DEX、做市、套利、跨链连接器生态，并且愿意把它视为“独立执行系统”。

非自研候选：

- Hummingbot（DEX/做市/套利）。建议以“独立项目/独立运行”方式引入，而不是塞进本仓库主闭环。

### 2.7 离线策略参考库与“项目大脑”（知识层）

默认（推荐，已落地）：

- 文档权威层：`docs/`（设计/规范/报告/离线参考资料）
- 检索加速层：`local_rag`（向量检索）+ `scripts/tools/vbrain.py`（统一入口）
- 跨会话记忆：In-Memoria（见 `docs/setup/vibe_brain_workflow.md`）

本仓库的关键决策（避免误区）：

- 向量库 `.vibe/local-rag/` 是**可重建缓存**，默认不入库；Git 同步的是 `docs/` 与脚本/配置（见 `docs/reports/local_vector_db_review_2026-01-15_v1.0.md`）。

### 2.8 编排与自动化（别急着上“平台”）

默认（推荐）：

- 统一用 `scripts/` 里的脚本作为“控制平面”，把数据转换/训练/评估/回测流程固定成可复现命令。
- 已收口的端到端一键入口：`scripts/workflows/quant_e2e.ps1`（下载→训练→体检→回测报告，可先用 `-WhatIf` 预览）。

何时需要升级到编排系统：

- 你有多个周期任务（多交易所/多币种/多时间框架）且需要可靠调度、可观测、失败重试、依赖管理；
- 你已经接受引入“常驻服务/可视化控制台/权限体系”的运维成本。

非自研候选：

- Dagster 或 Airflow 均属于平台化选择；引入前必须先明确：你是否真的需要它们，而不是把脚本固化得更好。

### 2.9 监控与可观测性（先用现成能力）

默认（推荐）：

- 先用 Freqtrade 自带日志/通知能力（例如 Telegram），再配合 `artifacts/` 输出复盘报告。

何时需要升级：

- 24/7 实盘、多个策略同时运行、你需要统一仪表盘与告警（错误率、延迟、资金曲线、最大回撤等）。

非自研候选：

- Prometheus + Grafana 是成熟组合，但属于“基础设施级”引入；请先做“最小可用告警”闭环验证，再决定是否平台化。

---

## 3. 引入新框架的“模块级一次性落地”验收清单（避免半成品）

当你决定引入某个新框架（例如 TSDB/编排/监控/第二执行系统）时，必须一次性满足：

1) **权威入口**：在 `scripts/` 中提供统一入口（PowerShell），并写清楚最小复现命令。
2) **配置口径**：配置放在 `04_shared/`（可提交），密钥放在 `.env`/`config-private.json`（必须 gitignore）。
3) **数据口径**：明确输入输出与索引键（symbol/timeframe/时区/费用模型），禁止出现“同名不同义”。
4) **验收用例**：至少 1 个可复现的端到端验收（含失败处理与回滚路径）。
5) **不造轮子复核**：在仓库与生态中确认没有现成方案；若确实没有，按 `docs/guidelines/refactor_policy.md` 的“必须造轮子先申请”流程走。

---

## 4. 推荐阅读（本仓库内已固化的权威文档）

- 目录结构与 Qlib 工程化闭环：`docs/knowledge/freqtrade_qlib_engineering_workflow.md`
- 项目大脑工作流（离线知识库/检索/记忆）：`docs/setup/vibe_brain_workflow.md`
- 本地向量库选型（Git 友好与缓存边界）：`docs/reports/local_vector_db_review_2026-01-15_v1.0.md`
- 加密交易执行框架选型（Freqtrade/Hummingbot）：`docs/reports/crypto_trading_framework_review_2026-01-15_v1.0.md`
- 架构与重构规范（一次性到位 + 不造轮子）：`docs/guidelines/refactor_policy.md`
