# 加密资产价格预测模型：工程验收清单与落地边界（本仓库版）

更新日期：2026-01-15

本文目标：

1. 把“预测论文里的高分”（R²/MAE/方向准确率）翻译成**可复现、可审计、成本敏感**的工程验收标准。
2. 说明常见预测模型族（N-BEATS / CNN-BiLSTM / Transformer 变体）各自更适合解决什么问题，以及最容易踩的坑。
3. 给出本仓库的最短落地路径：先在研究层离线验证，再决定是否接入执行层/风控层。

> 重要提醒：  
> - “价格预测”（时间序列）与“因子定价”（横截面）是两类问题，不要混用指标做“最优模型排名”。  
> - 看到极高的 R²/极低的 MAE，优先怀疑：预测目标选错（预测价格水平）、数据泄漏、或评估设置与交易无关。
> - 本项目当前主线就是**单交易对时间序列预测/择时**；本文为主线落地的工程验收口径。

---

## 0) 一句话结论

预测模型的落地难点不在网络结构，而在**无泄漏评估、交易成本敏感性、制度切换鲁棒性**；对本仓库更稳健的做法是把预测输出当作“连续权重/风险预算”，而不是硬方向开关。

信息论视角下的“熵/转移熵/复杂度”特征与风险含义，可配套阅读：`docs/knowledge/crypto_information_theory_signal_system_playbook.md`。

---

## 1) 先把“预测目标”定义清楚

工程上常见三类目标，含义完全不同：

1. **方向（classification）**：预测未来 N 根 K 线收益是否为正（更适合作为入场门控或仓位折扣的信号源）。
2. **收益幅度（regression）**：预测未来 N 根 K 线的收益/对数收益（更适合做连续权重，但对噪声与成本更敏感）。
3. **体制/波动（regime / volatility forecasting）**：预测波动、回撤风险或“危机体制”（更适合作为风控层输入）。

强烈不建议把“预测价格水平（price level）”当成主要目标：在长趋势资产上，它非常容易得到看似很高的 R²，但对交易决策帮助有限。

---

## 2) 预测论文高分的常见陷阱（工程侧必须逐条排除）

1. **数据泄漏（Look-ahead）**：
   - 特征窗口或标准化使用了未来数据（全样本均值方差、未来极值等）。
   - 标签与特征对齐错误（特征其实包含了标签窗口的一部分）。
2. **切分错误（Split leakage）**：
   - 随机切分或 shuffle 会让相邻时间段互相“偷看”，尤其是滑动窗口样本高度重叠时。
3. **评估与交易目标不一致**：
   - MAE/RMSE 下降不代表交易收益上升；方向正确但幅度估计错误也会导致过度交易。
4. **成本缺失**：
   - 未计入手续费/点差/冲击成本时，高频再平衡策略的“理论优势”常被成本吞噬。
5. **单币过拟合**：
   - 只在 BTC 上有效、换到 ETH 或换一段制度就崩溃，通常是非稳健特征或过强模型容量导致。

---

## 3) 模型族速览：更像“工具箱”，不是银弹

### 3.1 N-BEATS（全连接堆栈）

要点：

- 结构相对简单，但对数据预处理、标签定义与切分方式极度敏感 [1]。
- 如果论文报告“极高 R²”，建议首先检查：是否在预测价格水平、以及是否存在泄漏 [2]。

### 3.2 CNN-BiLSTM + 注意力（混合架构）

要点：

- CNN 提取短期局部形态，BiLSTM 捕捉更长依赖，注意力用于动态加权关键时间步 [3]。
- 落地前必须做成本敏感评估：该类模型常给出“更平滑的预测”，但并不自动转化为更高净收益。

### 3.3 Transformer/TimeXer 等变体

要点：

- 优势通常在“更长依赖 + 多变量建模”，但对训练数据量、特征工程与正则化更苛刻 [4]。
- 若引入宏观/流动性等外部特征，必须先解决数据对齐与版本治理，否则结果不可复现。

---

## 4) 最小工程验收清单（建议作为硬门槛）

1. **无泄漏切分**：严格按时间顺序做 walk-forward；滑动窗口样本需确保训练与测试不共享未来信息。
2. **成本敏感回放**：把手续费/点差/冲击成本写进评估，至少给出“净收益/回撤/换手”的同时报表。
3. **多制度评估**：上涨/下跌/震荡三段分别评估（避免单一制度的偶然高分）。
4. **稳定性与漂移**：输出特征分布基线，并在回放中检查漂移触发频率与误触率。
5. **可复现落盘**：固定数据版本、特征清单、训练参数与评估窗口，并把外部来源登记到 `docs/knowledge/source_registry.md`。

---

## 5) 落地到本仓库：建议路线（从研究到执行）

### 5.1 研究层（离线）：先用现有管线做基线

- 数据准备：用 `scripts/qlib/convert_freqtrade_to_qlib.py` 把 Freqtrade OHLCV 转成研究层数据集。
- 基线验证：优先用现有的 `scripts/qlib/train_model.py` + `scripts/qlib/timing_audit.py`，先回答“在本仓库口径下，预测是否稳定、是否成本敏感”。

### 5.2 执行层（在线）：把预测输出当作风险预算

建议把预测输出接入以下位置之一：

- 入场门控（Gate）：预测置信度不足则不新开仓；
- 风险缩放（Soft）：把预测置信度映射为仓位/杠杆折扣；
- 体制/风险闭环：与 `auto_risk` 联动，把制度切换与漂移映射为可执行动作（禁新开/强降风险）。

---

## 6) 来源（已登记到 `docs/knowledge/source_registry.md`）

- [1] https://arxiv.org/pdf/1905.10437.pdf（S-1006）
- [2] https://publications.eai.eu/index.php/sis/article/view/9006（S-1007）
- [3] https://www.scitepress.org/Papers/2024/132698/132698.pdf（S-1008）
- [4] https://arxiv.org/html/2512.22326v1（S-1009）
